# Grok 批量视频提交助手

---原作者：生财有术-小黄快跑---

## 功能
- 在 `https://grok.com/imagine` 页面按顺序批量上传本地图片
- 多行提示词：一行对应一张图片
- 自动等待页面跳转到专属生成页面 `/imagine/post/*`
- 自动填入视频提示词并点击“生成视频”
- 生成阶段后自动点击“返回”继续下一项
- 支持暂停/继续、日志导出
- 点击开始时自动将图片压缩为 WebP（质量约 0.9）以提升上传与处理效率
- 每次任务之间固定延时 2 秒，避免提交混乱
- 已合并视频下载功能

### 新增（已合并）：Grok 视频下载器
- 在任意 `https://grok.com/*` 页面识别 `<video>` 元素
- 浮动“📥 下载视频”按钮，支持可拖拽与位置记忆
- 弹出选择面板，支持批量前缀、重命名与多选下载
- 通过浏览器下载管理器发起下载（无需每次确认）

## 使用步骤
1. 在 Chrome 中打开 `chrome://extensions` 并开启开发者模式。
2. 点击“加载已解压的扩展程序”，选择本项目根目录。
3. 登录 grok 并进入 `https://grok.com/imagine` 页面。
4. 点击扩展图标打开弹窗：
   - 选择多张图片（选择顺序即处理顺序）。
   - 在文本框中粘贴提示词，按行对应图片；若某图片无对应提示词则使用空串（可在生成页面手动补充）。
   - 配置可选参数：生成超时、导航等待时间。
   - 点击“开始”。
   - 如需下载视频，点击“打开视频下载器”，在页面上选择视频后批量下载。
5. 运行时可“暂停”与“继续”。失败项会跳过并记录在日志。
6. 处理结束后可“导出日志”保存文本。

## 参数说明
- 生成超时：等待视频生成完成的最大秒数（到时仍未检测到 video/canvas 会继续下一张）。
- 导航等待：从上传到跳转、返回主页面的最大等待时间。
- 自动滚动：生成页面到达后滚动到顶部以避免元素不在视窗。
  
## 今日更新
- 新增：启动时自动对选中图片进行 WebP 压缩（保持分辨率，默认质量 0.9）。
- 变更：批处理任务间隔由随机 1–2 秒改为固定 2 秒，确保队列更稳定。
 - 合并：内置“Grok 视频下载器”，弹窗一键唤出下载面板。

## 可能的限制与注意
- 站点 DOM 结构若变动需更新选择器 (aria-label)。
- 若没有可访问的 `input[type=file]`，脚本尝试使用剪贴板 paste，可能受浏览器权限限制并失败。
- 视频生成完成的检测目前使用出现 `<video>` / `<canvas>` 元素的简单策略，可能需根据真实页面调整。
- 大量文件处理前建议先用 1-2 张测试。
- **网络问题**：如果未开启全局代理，grok 页面资源（头像、图片、视频）可能加载异常（显示破损），这与插件无关，是网络访问限制导致。建议保持全局模式或确保 grok.com 可正常访问。
- 悬浮球 z-index 已降低至 9999，避免遮挡页面重要元素（如账户菜单）。
 - 下载功能依赖 `downloads` 权限，如浏览器阻止请检查扩展权限设置。

## 后续改进建议
- 增加失败重试次数配置
- CSV 文件精确映射 `filename,prompt`
- 更稳健的生成完成状态检测 (监听网络或特定 DOM 标记)
- 在 background 中集中队列，支持 popup 关闭后继续

## 卸载
从 `chrome://extensions` 移除即可。
